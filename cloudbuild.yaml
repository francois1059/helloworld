steps:
- name: 'node'
  entrypoint: 'npm'
  args: ['install']
- name: 'node'
  entrypoint: 'npm'
  args: ['test']
- name: 'gcr.io/cloud-builders/docker'
  script: |
    docker build -t europe-west1-docker.pkg.dev/$PROJECT_ID/synapps-sandbox-registry/quickstart:$TAG_NAME .
  automapSubstitutions: true
- name: 'gcr.io/$PROJECT_ID/helm'
  args: ['upgrade', '--install', './helm', '--namespace', 'mailer']
  env:
  - 'CLOUDSDK_COMPUTE_ZONE=europe-west9'
  - 'CLOUDSDK_CONTAINER_CLUSTER=gke-sandbox'
tags: ['cloud-builders-community']
images:
- 'europe-west1-docker.pkg.dev/$PROJECT_ID/synapps-sandbox-registry/quickstart:$TAG_NAME'